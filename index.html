<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>KINYO 商品查價系統</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 920px;
      margin: 40px auto;
      padding: 0 16px;
      background: #f5f5f5;
    }
    h1 {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .subtitle {
      font-size: 14px;
      color: #666;
      margin-bottom: 20px;
    }
    .search-box {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.08);
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    label {
      font-weight: 600;
    }
    input {
      flex: 1;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: white;
      font-weight: 600;
      cursor: pointer;
    }
    .card {
      margin-top: 20px;
      background: #fff;
      padding: 18px;
      border-radius: 10px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.08);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 14px;
    }
    th, td {
      padding: 6px 8px;
      border-bottom: 1px solid #e5e7eb;
      text-align: left;
      white-space: nowrap;
    }
    th {
      background: #f3f4f6;
      font-weight: 600;
    }
    tr:hover {
      background: #f9fafb;
      cursor: pointer;
    }
    .row { margin-bottom: 8px; font-size: 15px; }
    .label { font-weight: 600; display: inline-block; width: 160px; }
    a { color: #2563eb; }
    .hint { font-size: 12px; color: #888; margin-top: 6px; }
  </style>
</head>
<body>
  <h1>KINYO 商品查價系統</h1>
  <div class="subtitle">
    可搜尋：<b>商品型號 / 商品名稱</b>（模糊搜尋，支援片段字符）
  </div>

  <div class="search-box">
    <label for="modelInput">搜尋：</label>
    <input id="modelInput" placeholder="輸入型號或商品名稱，例如：5712、風扇、無線" />
    <button id="searchBtn">查詢</button>
  </div>

  <div id="loading" class="card" style="display:none;">查詢中，請稍候…</div>
  <div id="noResult" class="card" style="display:none;">查無符合的商品。</div>

  <!-- 多筆結果列表 -->
  <div id="list" class="card" style="display:none;">
    <div>
      找到 <span id="list-count"></span> 筆商品：
    </div>
    <table>
      <thead>
        <tr>
          <th>型號</th>
          <th>名稱</th>
          <th>直播價</th>
          <th>末售</th>
          <th>賣場</th>
        </tr>
      </thead>
      <tbody id="list-body"></tbody>
    </table>
    <div class="hint">點選任一列可查看完整資料。</div>
  </div>

  <!-- 詳細資料 -->
  <div id="result" class="card" style="display:none;">
    <h2 id="r-name"></h2>
    <div class="row"><span class="label">商品型號：</span><span id="r-model"></span></div>
    <div class="row"><span class="label">商品名稱：</span><span id="r-name2"></span></div>
    <div class="row"><span class="label">國際條碼：</span><span id="r-barcode"></span></div>
    <div class="row"><span class="label">箱入數：</span><span id="r-cartonQty"></span></div>
    <div class="row"><span class="label">直播售價：</span><span id="r-groupPriceLive"></span></div>
    <div class="row"><span class="label">末售價格：</span><span id="r-minPrice"></span></div>
    <div class="row"><span class="label">賣場價格：</span><span id="r-marketPrice"></span></div>
    <div class="row"><span class="label">採購100：</span><span id="r-quote100"></span></div>
    <div class="row"><span class="label">採購300：</span><span id="r-quote300"></span></div>
    <div class="row"><span class="label">採購500：</span><span id="r-quote500"></span></div>
    <div class="row"><span class="label">BSMI：</span><span id="r-bsmi"></span></div>
    <div class="row"><span class="label">NCC：</span><span id="r-ncc"></span></div>
    <div class="row">
      <span class="label">官方頁面：</span>
      <a id="r-url" target="_blank">前往</a>
    </div>
  </div>

  <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyDtp6rwV7KmIOedLQ9793BnXbBquopP9kM",
      authDomain: "kinyo-price.firebaseapp.com",
      projectId: "kinyo-price",
      storageBucket: "kinyo-price.firebasestorage.app",
      messagingSenderId: "122464645678",
      appId: "1:122464645678:web:c0febbc6297a8ada5ea5bf",
      measurementId: "G-R0PWMZNSJH"
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // DOM 元件
    const input = document.getElementById("modelInput");
    const btn = document.getElementById("searchBtn");
    const loading = document.getElementById("loading");
    const noResult = document.getElementById("noResult");
    const listCard = document.getElementById("list");
    const listBody = document.getElementById("list-body");
    const listCount = document.getElementById("list-count");
    const resultCard = document.getElementById("result");

    const rName = document.getElementById("r-name");
    const rName2 = document.getElementById("r-name2");
    const rModel = document.getElementById("r-model");
    const rBarcode = document.getElementById("r-barcode");
    const rCartonQty = document.getElementById("r-cartonQty");
    const rGroupPriceLive = document.getElementById("r-groupPriceLive");
    const rMinPrice = document.getElementById("r-minPrice");
    const rMarketPrice = document.getElementById("r-marketPrice");
    const rQuote100 = document.getElementById("r-quote100");
    const rQuote300 = document.getElementById("r-quote300");
    const rQuote500 = document.getElementById("r-quote500");
    const rBsmi = document.getElementById("r-bsmi");
    const rNcc = document.getElementById("r-ncc");
    const rUrl = document.getElementById("r-url");

    function showDetail(d) {
      if (!d) return;

      rName.textContent = d.name ?? "";
      rName2.textContent = d.name ?? "";
      rModel.textContent = d.model ?? "";
      rBarcode.textContent = d.barcode ?? "";
      rCartonQty.textContent = d.cartonQty ?? "";

      rGroupPriceLive.textContent = d.groupPriceLive ?? "";
      rMinPrice.textContent = d.minPrice ?? "";
      rMarketPrice.textContent = d.marketPrice ?? "";

      rQuote100.textContent = d.quote100 ?? "";
      rQuote300.textContent = d.quote300 ?? "";
      rQuote500.textContent = d.quote500 ?? "";

      rBsmi.textContent = d.bsmi ?? "";
      rNcc.textContent = d.ncc ?? "";

      if (d.productUrl) {
        rUrl.href = d.productUrl;
        rUrl.textContent = "前往";
      } else {
        rUrl.href = "#";
        rUrl.textContent = "";
      }

      resultCard.style.display = "block";
    }

    async function search() {
      const keyword = input.value.trim();
      if (!keyword) return;

      const kwUpper = keyword.toUpperCase();
      const kwLower = keyword.toLowerCase();

      loading.style.display = "block";
      noResult.style.display = "none";
      resultCard.style.display = "none";
      listCard.style.display = "none";
      listBody.innerHTML = "";

      try {
        const snap = await getDocs(collection(db, "Products"));
        const results = [];

        snap.forEach((docSnap) => {
          const d = docSnap.data();

          const model = (d.model || "").toUpperCase();
          const name = (d.name || "").toLowerCase();

          // 型號包含 OR 名稱包含
          if (model.includes(kwUpper) || name.includes(kwLower)) {
            results.push(d);
          }
        });

        if (results.length === 0) {
          noResult.style.display = "block";
          return;
        }

        // 排序
        results.sort((a, b) =>
          (a.model || "").localeCompare(b.model || "", "en")
        );

        // 一筆 → 直接顯示
        if (results.length === 1) {
          showDetail(results[0]);
          return;
        }

        // 多筆 → 顯示清單
        listCount.textContent = results.length;

        results.forEach((item) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${item.model ?? ""}</td>
            <td>${item.name ?? ""}</td>
            <td>${item.groupPriceLive ?? ""}</td>
            <td>${item.minPrice ?? ""}</td>
            <td>${item.marketPrice ?? ""}</td>
          `;
          tr.addEventListener("click", () => showDetail(item));
          listBody.appendChild(tr);
        });

        listCard.style.display = "block";
        showDetail(results[0]); // 預設第一筆
      } finally {
        loading.style.display = "none";
      }
    }

    btn.addEventListener("click", search);
    input.addEventListener("keydown", (e) => {
      if (e.key === "Enter") search();
    });
  </script>
</body>
</html>
