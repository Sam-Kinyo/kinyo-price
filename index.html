<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>KINYO 商品查價系統</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 820px;
      margin: 40px auto;
      padding: 0 16px;
      background: #f5f5f5;
    }
    h1 {
      font-size: 26px;
      font-weight: 700;
      margin-bottom: 6px;
    }
    .subtitle {
      font-size: 14px;
      color: #666;
      margin-bottom: 20px;
    }
    .search-box {
      background: #fff;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.08);
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    label {
      font-weight: 600;
    }
    input {
      flex: 1;
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      padding: 8px 18px;
      border-radius: 999px;
      border: none;
      background: #111827;
      color: white;
      font-weight: 600;
      cursor: pointer;
    }
    button:disabled {
      opacity: 0.5;
      cursor: default;
    }
    .card {
      margin-top: 20px;
      background: #fff;
      padding: 18px;
      border-radius: 10px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.08);
    }
    .row {
      margin-bottom: 8px;
      font-size: 15px;
    }
    .label {
      font-weight: 600;
      display: inline-block;
      width: 160px;
    }
    a {
      color: #2563eb;
    }
  </style>
</head>
<body>
  <h1>KINYO 商品查價系統</h1>
  <div class="subtitle">輸入商品型號後，系統會顯示完整商品資訊與各種價格。</div>

  <div class="search-box">
    <label for="modelInput">商品型號：</label>
    <input id="modelInput" placeholder="例如：AWP5712W" />
    <button id="searchBtn">查詢</button>
  </div>

  <div id="loading" class="card" style="display:none;">查詢中，請稍候…</div>
  <div id="noResult" class="card" style="display:none;">查無此型號，請確認輸入是否正確。</div>

  <div id="result" class="card" style="display:none;">
    <h2 id="r-name"></h2>

    <div class="row"><span class="label">商品型號：</span><span id="r-model"></span></div>
    <div class="row"><span class="label">商品名稱：</span><span id="r-name2"></span></div>
    <div class="row"><span class="label">國際條碼：</span><span id="r-barcode"></span></div>
    <div class="row"><span class="label">箱入數：</span><span id="r-cartonQty"></span></div>

    <div class="row"><span class="label">團購(直播)售價：</span><span id="r-groupPriceLive"></span></div>
    <div class="row"><span class="label">末售價格：</span><span id="r-minPrice"></span></div>
    <div class="row"><span class="label">賣場價格：</span><span id="r-marketPrice"></span></div>

    <div class="row"><span class="label">採購100個報價：</span><span id="r-quote100"></span></div>
    <div class="row"><span class="label">採購300個報價：</span><span id="r-quote300"></span></div>
    <div class="row"><span class="label">採購500個報價：</span><span id="r-quote500"></span></div>

    <div class="row"><span class="label">BSMI：</span><span id="r-bsmi"></span></div>
    <div class="row"><span class="label">NCC：</span><span id="r-ncc"></span></div>

    <div class="row">
      <span class="label">官方商品頁：</span>
      <a id="r-url" href="#" target="_blank">點我前往</a>
    </div>
  </div>

  <script type="module">
    // 你的 Firebase 設定
    const firebaseConfig = {
      apiKey: "AIzaSyDtp6rwV7KmIOedLQ9793BnXbBquopP9kM",
      authDomain: "kinyo-price.firebaseapp.com",
      projectId: "kinyo-price",
      storageBucket: "kinyo-price.firebasestorage.app",
      messagingSenderId: "122464645678",
      appId: "1:122464645678:web:c0febbc6297a8ada5ea5bf",
      measurementId: "G-R0PWMZNSJH"
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import {
      getFirestore,
      getDoc,
      doc,
      collection,
      query,
      where,
      getDocs
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const modelInput = document.getElementById("modelInput");
    const searchBtn = document.getElementById("searchBtn");

    const resultCard = document.getElementById("result");
    const noResultCard = document.getElementById("noResult");
    const loadingCard = document.getElementById("loading");

    const rName = document.getElementById("r-name");
    const rName2 = document.getElementById("r-name2");
    const rModel = document.getElementById("r-model");
    const rBarcode = document.getElementById("r-barcode");
    const rCartonQty = document.getElementById("r-cartonQty");
    const rGroupPriceLive = document.getElementById("r-groupPriceLive");
    const rMinPrice = document.getElementById("r-minPrice");
    const rMarketPrice = document.getElementById("r-marketPrice");
    const rQuote100 = document.getElementById("r-quote100");
    const rQuote300 = document.getElementById("r-quote300");
    const rQuote500 = document.getElementById("r-quote500");
    const rBsmi = document.getElementById("r-bsmi");
    const rNcc = document.getElementById("r-ncc");
    const rUrl = document.getElementById("r-url");

    function showLoading(show) {
      loadingCard.style.display = show ? "block" : "none";
      searchBtn.disabled = show;
    }

    async function search() {
      let model = modelInput.value.trim();
      if (!model) return;

      model = model.toUpperCase(); // 自動轉大寫

      resultCard.style.display = "none";
      noResultCard.style.display = "none";
      showLoading(true);

      try {
        // 1. 先用文件 ID 精準查詢
        let snap = await getDoc(doc(db, "Products", model));
        let data = null;

        if (snap.exists()) {
          data = snap.data();
        } else {
          // 2. 查不到 → 用 searchKey 做前綴模糊搜尋
          const q = query(
            collection(db, "Products"),
            where("searchKey", ">=", model),
            where("searchKey", "<=", model + "\uf8ff")
          );

          const qsnap = await getDocs(q);
          if (!qsnap.empty) {
            snap = qsnap.docs[0];
            data = snap.data();
          }
        }

        if (!data) {
          noResultCard.style.display = "block";
          return;
        }

        // 顯示結果：價格欄位已經是「XXX 元」字串
        rName.textContent = data.name ?? "";
        rName2.textContent = data.name ?? "";
        rModel.textContent = data.model ?? "";
        rBarcode.textContent = data.barcode ?? "";
        rCartonQty.textContent = data.cartonQty ?? "";

        rGroupPriceLive.textContent = data.groupPriceLive ?? "";
        rMinPrice.textContent = data.minPrice ?? "";
        rMarketPrice.textContent = data.marketPrice ?? "";

        rQuote100.textContent = data.quote100 ?? "";
        rQuote300.textContent = data.quote300 ?? "";
        rQuote500.textContent = data.quote500 ?? "";

        rBsmi.textContent = data.bsmi ?? "";
        rNcc.textContent = data.ncc ?? "";

        if (data.productUrl) {
          rUrl.href = data.productUrl;
          rUrl.style.pointerEvents = "auto";
          rUrl.style.opacity = "1";
        } else {
          rUrl.href = "#";
          rUrl.style.pointerEvents = "none";
          rUrl.style.opacity = "0.5";
        }

        resultCard.style.display = "block";
      } catch (err) {
        console.error(err);
        noResultCard.style.display = "block";
      } finally {
        showLoading(false);
      }
    }

    searchBtn.addEventListener("click", search);
    modelInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") search();
    });
  </script>
</body>
</html>
