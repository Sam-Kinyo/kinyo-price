<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8" />
  <title>KINYO æŸ¥åƒ¹ç³»çµ± v4.5.1ï¼ˆä¸»å‹è™Ÿåˆä½µï¼å¿«å–ï¼å·¥ç¨‹å¸«ç¶­è­·ç‰ˆï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!--  
  ===============================================
  v4.5.1 â€” å·¥ç¨‹å¸«ç¶­è­·ç‰ˆï¼ˆå®Œæ•´è¨»è§£ï¼‰
  åŠŸèƒ½å¼·åŒ–ï¼š
  1. ä¸»å‹è™Ÿåˆä½µï¼ˆæ”¯æ´ KH195-PI / KH195PI / WV-KHP1230Wï¼‰
  2. localStorage å¿«å–ï¼ˆç„¡æœ‰æ•ˆæœŸï¼‰
  3. ç§»é™¤ã€Œå•†å“è¼‰å…¥ä¸­ã€å½ˆçª— â†’ æ”¹ç‚ºé é¢ Loading å€åŸŸ
  4. å ±åƒ¹å–®æŒ‰éˆ•æ•´åˆåˆ° toolbarï¼ˆåŒ¯å‡º Excel æ—é‚Šï¼‰
  5. Excel åŒ¯å‡ºå¯åŒ…å«åœ–ç‰‡é€£çµ
  6. å ±åƒ¹å–®æ–°å¢æ¯›åˆ©è¨ˆç®—
  7. æœå°‹æ”¯æ´ã€Œé—œéµå­— + èµ·è¨‚é‡ + é ç®—ã€ä¸‰æ¢ä»¶äº¤é›†
  8. ä¿®æ­£ detailCard ä¸é®æ“‹æœå°‹çµæœï¼ˆå¯¬åº¦å›ºå®šå³å´ï¼‰
  ===============================================
  -->

  <style>
    /* ---------------------------------------
       å…¨ç«™å…±ç”¨è®Šæ•¸ï¼ˆè‰²ç¥¨ï¼‹RWDï¼‰
    ------------------------------------------ */
    :root {
      --bg: #f5f6f8;
      --card: #ffffff;
      --primary: #111827;
      --border: #e5e7eb;
      --text: #1f2937;
      --muted: #6b7280;
      --radius: 12px;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
    }

    body {
      margin: 0;
      padding: 24px;
      background: var(--bg);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text);
      max-width: 1100px;
      margin: 0 auto;
    }

    h1 {
      margin: 0 0 4px;
    }

    .subtitle {
      color: var(--muted);
      margin-bottom: 18px;
      font-size: 14px;
    }

    /* ---------------------------------------
       ä½¿ç”¨è€…ç™»å…¥å€ï¼ˆå³ä¸Šè§’ï¼‰
    ------------------------------------------ */
    .top-bar {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 12px;
      margin-bottom: 14px;
      font-size: 13px;
    }

    .user-badge {
      background: #eef0f4;
      padding: 6px 14px;
      border-radius: 999px;
    }

    .logout-btn {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid var(--border);
      cursor: pointer;
      background: white;
      font-size: 12px;
    }

    /* ---------------------------------------
       è³‡æ–™ Loading å€åŸŸ
       ï¼ˆå–ä»£ alert è¼‰å…¥ä¸­å½ˆçª—ï¼‰
    ------------------------------------------ */
    #loadingStatus {
      background: #fff7d6;
      border-left: 4px solid #f7c948;
      padding: 10px 14px;
      border-radius: 8px;
      margin-bottom: 14px;
      font-size: 14px;
      display: none;
    }

    /* ---------------------------------------
       æœå°‹ç›’ï¼ˆæœå°‹ã€èµ·è¨‚é‡ã€é ç®—ï¼‰
    ------------------------------------------ */
    .search-box {
      background: var(--card);
      padding: 18px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 12px;
    }

    .search-row {
      margin-bottom: 14px;
    }

    label {
      font-weight: 600;
      margin-bottom: 6px;
      display: block;
      font-size: 14px;
    }

    input,
    select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 15px;
      box-sizing: border-box;
    }

    /* ---------------------------------------
       æŒ‰éˆ•
    ------------------------------------------ */
    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 999px;
      padding: 12px 20px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
    }

    .btn-secondary {
      background: white;
      border: 1px solid var(--border);
      padding: 10px 16px;
      border-radius: 999px;
      cursor: pointer;
      font-size: 14px;
    }

    .btn-secondary:disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .btn-outline-add {
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid #2563eb;
      background: #eff6ff;
      color: #2563eb;
      font-size: 12px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-outline-add:hover {
      background: #dbeafe;
    }

    /* ---------------------------------------
       Toolbarï¼ˆæ’åº + åŒ¯å‡º + å ±åƒ¹å–®ï¼‰
    ------------------------------------------ */
    .toolbar {
      display: flex;
      gap: 10px;
      align-items: center;
      margin: 10px 0 6px;
    }

    .toolbar select {
      flex: 1;
    }

    /* ---------------------------------------
       è¡¨æ ¼ï¼ˆæœå°‹çµæœï¼‰
    ------------------------------------------ */
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
    }

    th,
    td {
      padding: 12px 10px;
      border-bottom: 1px solid var(--border);
      font-size: 14px;
      vertical-align: top;
    }

    th {
      background: #fafafa;
      text-align: left;
    }

    /* ---------------------------------------
       åœ–ç‰‡
    ------------------------------------------ */
    .product-img {
      width: 110px;
      height: 110px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      background: #fff;
    }

    /* ---------------------------------------
       Detail Cardï¼ˆå³å´ 320pxï¼Œä¸é®ä½æœå°‹ï¼‰
    ------------------------------------------ */
    #detailCard {
      position: fixed;
      right: 25px;
      top: 120px;
      width: 320px;
      max-height: 78vh;
      overflow-y: auto;
      background: white;
      padding: 18px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: none;
      z-index: 999;
    }

    /* ---------------------------------------
       Bottom Sheetï¼ˆæ‰‹æ©Ÿ Detail / å ±åƒ¹å–®ï¼‰
    ------------------------------------------ */
    .sheet-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.45);
      z-index: 1000;
    }

    .sheet {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: 80vh;
      background: #fff;
      border-radius: 16px 16px 0 0;
      transform: translateY(100%);
      transition: transform .25s ease;
      display: flex;
      flex-direction: column;
      z-index: 1001;
    }

    .sheet.open {
      transform: translateY(0);
    }

    .sheet-header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .sheet-close {
      background: none;
      border: none;
      font-size: 26px;
      cursor: pointer;
      line-height: 1;
    }

    .sheet-content {
      padding: 16px;
      overflow-y: auto;
      font-size: 15px;
      flex: 1;
    }

    .hidden {
      display: none !important;
    }

    /* ---------------------------------------
       å ±åƒ¹å–® List
    ------------------------------------------ */
    .quote-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
    }

    .quote-info {
      font-size: 14px;
    }

    .quote-price {
      font-weight: 700;
      color: #2563eb;
    }

    .quote-del {
      color: #999;
      cursor: pointer;
      padding: 6px;
      font-size: 16px;
    }

    .quote-del:hover {
      color: #ef4444;
    }

    /* ---------------------------------------
       RWD
    ------------------------------------------ */
    @media (max-width: 900px) {
      #detailCard {
        display: none !important;
      }
    }

    @media (max-width: 600px) {
      body {
        padding: 14px;
      }

      .search-box {
        padding: 14px;
      }

      input,
      select {
        font-size: 14px;
      }

      .product-img {
        width: 90px;
        height: 90px;
      }

      th,
      td {
        padding: 8px 6px;
        font-size: 13px;
      }
    }
  </style>
</head>
<body>

  <!-- =============================
       ç™»å…¥è³‡è¨Šå€ï¼ˆå³ä¸Šè§’ï¼‰
  ============================== -->
  <div class="top-bar">
    <span id="userInfo" class="user-badge">æœªç™»å…¥</span>
    <button id="logoutBtn" class="logout-btn" style="display:none;">ç™»å‡º</button>
  </div>

  <!-- =============================
       Loading å€åŸŸï¼ˆå–ä»£ alertï¼‰
  ============================== -->
  <div id="loadingStatus">
    ğŸ”„ å•†å“è³‡æ–™è¼‰å…¥ä¸­ï¼Œè«‹ç¨å€™â€¦
  </div>

  <h1>KINYO æŸ¥åƒ¹ç³»çµ±</h1>
  <div class="subtitle">ä¸»å‹è™Ÿè‡ªå‹•åˆä½µï¼ˆå¤šè‰²åƒ…é¡¯ç¤ºä»£è¡¨ä¸€ç­†ï¼‰ï¼ localStorage å¿«å–</div>


  <!-- =============================
       æœå°‹å€ï¼ˆé—œéµå­—ï¼èµ·è¨‚é‡ï¼é ç®—ï¼‰
  ============================== -->
  <div class="search-box">

    <!-- é—œéµå­—æœå°‹ -->
    <div class="search-row">
      <label>é—œéµå­—æœå°‹ï¼ˆå‹è™Ÿ / åç¨±ï¼‰</label>
      <input id="keyword" placeholder="å¦‚ï¼šCL528 / æ•èšŠç‡ˆ / é™¤æ¯›çƒæ©Ÿ" />
    </div>

    <!-- èµ·è¨‚é‡ -->
    <div class="search-row">
      <label>èµ·è¨‚é‡ï¼ˆå¯ä¸é¸ï¼‰</label>
      <select id="qtySelect"></select>
    </div>

    <!-- é ç®—å€é–“ -->
    <div class="search-row">
      <label>é ç®—å€é–“ï¼ˆå¯åªå¡«æœ€ä½æˆ–æœ€é«˜ï¼‰</label>
      <div style="display:flex; gap:10px;">
        <input id="minPrice" type="number" placeholder="æœ€ä½ (å¯ç©º)">
        <input id="maxPrice" type="number" placeholder="æœ€é«˜ (å¯ç©º)">
      </div>
    </div>

    <!-- æŸ¥è©¢æŒ‰éˆ• -->
    <button id="searchBtn" class="btn-primary" disabled>æŸ¥è©¢</button>

    <!-- æ¸…é™¤æ¢ä»¶ -->
    <button id="clearBtn" class="btn-secondary" style="margin-top:10px;width:100%;">æ¸…é™¤æœå°‹</button>
  </div>



  <!-- =============================
       Toolbarï¼ˆæ’åº + åŒ¯å‡º + å ±åƒ¹å–®ï¼‰
  ============================== -->
  <div class="toolbar">
    <select id="sortSelect" class="btn-secondary">
      <option value="">ä¸æ’åº</option>
      <option value="minPriceAsc">æœ«å”®ï¼šä½ â†’ é«˜</option>
      <option value="minPriceDesc">æœ«å”®ï¼šé«˜ â†’ ä½</option>
      <option value="marketAsc">è³£å ´ï¼šä½ â†’ é«˜</option>
      <option value="marketDesc">è³£å ´ï¼šé«˜ â†’ ä½</option>
      <option value="alphaAsc">ä¸»å‹è™Ÿï¼šA â†’ Z</option>
      <option value="alphaDesc">ä¸»å‹è™Ÿï¼šZ â†’ A</option>
    </select>

    <!-- åŒ¯å‡º Excel -->
    <button id="exportBtn" class="btn-secondary" disabled>åŒ¯å‡º Excel</button>

    <!-- å ±åƒ¹å–®æŒ‰éˆ•ï¼ˆå–ä»£å³ä¸‹è§’ FABï¼‰ -->
    <button id="openQuoteBtn" class="btn-secondary">ğŸ“‹ å ±åƒ¹å–®</button>
  </div>



  <!-- =============================
       æœå°‹çµæœè¡¨æ ¼
  ============================== -->
  <table id="resultTable" style="display:none;">
    <thead>
      <tr>
        <th style="width:32px;"><input type="checkbox" id="checkAll" /></th>
        <th style="width:120px;">åœ–ç‰‡</th>
        <th style="width:100px;">ä¸»å‹è™Ÿ</th>
        <th>å•†å“è³‡è¨Š</th>
        <th style="width:80px;">æœ«å”®</th>
        <th style="width:80px;">è³£å ´</th>
      </tr>
    </thead>
    <tbody id="resultBody"></tbody>
  </table>



  <!-- =============================
       æ¡Œæ©Ÿç‰ˆ Detail Cardï¼ˆå³å´å›ºå®š 320pxï¼‰
  ============================== -->
  <div id="detailCard"></div>



  <!-- =============================
       æ‰‹æ©Ÿ Bottom Sheetï¼ˆå•†å“è©³ç´°è³‡è¨Šï¼‰
  ============================== -->
  <div id="sheetBackdrop" class="sheet-backdrop hidden"></div>

  <div id="mobileDetailSheet" class="sheet hidden">
    <div class="sheet-header">
      <span>å•†å“è³‡è¨Š</span>
      <button id="sheetCloseBtn" class="sheet-close">Ã—</button>
    </div>
    <div class="sheet-content" id="sheetContent"></div>
  </div>



  <!-- =============================
       å ±åƒ¹å–® Bottom Sheet
  ============================== -->
  <div id="quoteSheet" class="sheet hidden">
    <div class="sheet-header">
      <span>å ±åƒ¹å–®é è¦½</span>
      <button id="quoteCloseBtn" class="sheet-close">Ã—</button>
    </div>

    <div class="sheet-content" style="display:flex;flex-direction:column;">
      <div id="quoteListBody" style="flex:1;overflow-y:auto;"></div>

      <div style="border-top:1px solid #eee; padding-top:12px; margin-top:10px;">
        <div style="display:flex;justify-content:space-between;font-weight:bold;font-size:16px;margin-bottom:12px;">
          <span>ç¸½è¨ˆé‡‘é¡</span>
          <span id="quoteTotal">$0</span>
        </div>

        <!-- æ¯›åˆ©é¡¯ç¤º -->
        <div style="display:flex;justify-content:space-between;color:#555;margin-bottom:12px;font-size:14px;">
          <span>æ¯›åˆ©ï¼ˆè³£å ´åƒ¹ vs èµ·è¨‚é‡æˆæœ¬ï¼‰</span>
          <span id="quoteProfit">0%</span>
        </div>

        <button id="copyQuoteBtn" class="btn-primary" style="width:100%;">è¤‡è£½å ±åƒ¹å–®ï¼ˆLINEï¼‰</button>

        <button id="clearQuoteBtn" class="btn-secondary"
          style="width:100%;margin-top:8px;color:#ef4444;border-color:#ef4444;">
          æ¸…ç©ºå ±åƒ¹å–®
        </button>
      </div>
    </div>
  </div>
<!-- ========================================================
       ç¬¬ 3 æ®µï¼šJS å¥—ä»¶å¼•å…¥å€
       Firebase / XLSX ï¼ˆç”¨æ–¼ Excel åŒ¯å‡ºï¼‰
  ========================================================= -->

  <!-- åŒ¯å‡º Excel æ‰€éœ€å¥—ä»¶ -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <!-- Firebase æ ¸å¿ƒ + Firestore + Auth -->
  <script type="module">

    /*  
    ============================================================
      Firebase åˆå§‹åŒ–
    ============================================================
    */

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";


    /*  
    ============================================================
      Firebase Config
    ============================================================
    */

    const firebaseConfig = {
      apiKey: "AIzaSyDtp6rwV7KmIOedLQ9793BnXbBquopP9kM",
      authDomain: "kinyo-price.firebaseapp.com",
      projectId: "kinyo-price",
      storageBucket: "kinyo-price.firebasestorage.app",
      messagingSenderId: "122464645678",
      appId: "1:122464645678:web:c0febbc6297a8ada5ea5bf"
    };


    // åˆå§‹åŒ–
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    /*  
    ============================================================
      å…¨åŸŸè®Šæ•¸å®£å‘Šï¼ˆä¸‹ä¸€æ®µ JS æœƒä½¿ç”¨ï¼‰
    ============================================================
    */

    let productCache = [];         // å•†å“å¿«å–ï¼ˆå« localStorageï¼‰
    let currentResultList = [];    // æœå°‹çµæœ
    let userLevel = 1;             // Firebase Users level
    let currentUserEmail = "";
    let quoteList = [];            // å ±åƒ¹å–®é …ç›®

    // DOM å…ƒç´ ç·©å­˜
    const keywordInput   = document.getElementById("keyword");
    const qtySelect      = document.getElementById("qtySelect");
    const minPriceInput  = document.getElementById("minPrice");
    const maxPriceInput  = document.getElementById("maxPrice");
    const sortSelect     = document.getElementById("sortSelect");
    const exportBtn      = document.getElementById("exportBtn");
    const clearBtn       = document.getElementById("clearBtn");
    const resultTable    = document.getElementById("resultTable");
    const resultBody     = document.getElementById("resultBody");
    const checkAllBox    = document.getElementById("checkAll");
    const detailCard     = document.getElementById("detailCard");
    const loadingStatus  = document.getElementById("loadingStatus");

    // æ‰‹æ©Ÿè©³ç´°è³‡æ–™ Sheet
    const sheetBackdrop  = document.getElementById("sheetBackdrop");
    const mobileSheet    = document.getElementById("mobileDetailSheet");
    const sheetContent   = document.getElementById("sheetContent");
    const sheetCloseBtn  = document.getElementById("sheetCloseBtn");

    // å ±åƒ¹å–® Sheet
    const quoteSheet     = document.getElementById("quoteSheet");
    const quoteCloseBtn  = document.getElementById("quoteCloseBtn");
    const quoteListBody  = document.getElementById("quoteListBody");
    const quoteTotalEl   = document.getElementById("quoteTotal");
    const quoteProfitEl  = document.getElementById("quoteProfit");
    const copyQuoteBtn   = document.getElementById("copyQuoteBtn");
    const clearQuoteBtn  = document.getElementById("clearQuoteBtn");

    // å³ä¸Šè§’ç™»å…¥è³‡è¨Š
    const userInfoSpan   = document.getElementById("userInfo");
    const logoutBtn      = document.getElementById("logoutBtn");

    // toolbar å ±åƒ¹å–®æŒ‰éˆ•
    const openQuoteBtn   = document.getElementById("openQuoteBtn");
/*  
    ============================================================
      v4.5.1 æ ¸å¿ƒå·¥å…·èˆ‡è¦å‰‡
    ============================================================
    */

    /**
     * ä¸»å‹è™Ÿåˆä½µè¦å‰‡ï¼ˆæœ€çµ‚ç‰ˆï¼‰
     * - model å¯èƒ½æ ¼å¼ï¼š
     *   KH195PI / KH195-PI / WV-KHP1230W / WV-KHP1230-BK
     * - åˆ¤æ–·æ–¹å¼ï¼š
     *   split(- or _) å¾Œæœ€å¾Œä¸€æ®µè‹¥ç‚ºç´”è‹±æ–‡ â†’ è¦–ç‚ºé¡è‰²ç¢¼ â†’ ç§»é™¤
     */
    function getMainModel(model) {
      if (!model) return "";
      const m = model.trim().toUpperCase();

      // ä»¥ "-" "_" ä½œç‚ºåˆ†éš”ç¬¦è™Ÿ
      const parts = m.split(/[-_]/);

      // å–æœ€å¾Œä¸€æ®µåšé¡è‰²åˆ¤æ–·ï¼ˆå¦‚ PI / BK / Wï¼‰
      const last = parts[parts.length - 1];

      // æœ€å¾Œä¸€æ®µç‚ºç´”è‹±æ–‡ => é¡è‰²ç¢¼
      if (/^[A-Z]+$/.test(last)) {
        const mainParts = parts.slice(0, parts.length - 1);
        return mainParts.join("-");
      }

      return m;
    }

    /**
     * æœå°‹ key æ­£è¦åŒ–
     */
    function normalizeKey(str) {
      return (str || "")
        .toString()
        .toLowerCase()
        .replace(/\s+/g, " ")
        .trim();
    }

    /**
     * localStorage å¿«å– key
     */
    const LS_KEY = "KINYO_PRODUCTS_CACHE_V451";


    /*  
    ============================================================
      å•†å“é è¼‰ï¼ˆFirestore â†’ localStorage å¿«å–ï¼‰
    ============================================================
    */

    async function preloadProducts() {
      loadingStatus.style.display = "block";
      document.getElementById("searchBtn").disabled = true;

      // 1) å…ˆè®€ localStorage å¿«å–
      try {
        const cachedRaw = localStorage.getItem(LS_KEY);
        if (cachedRaw) {
          const cached = JSON.parse(cachedRaw);
          if (Array.isArray(cached) && cached.length) {
            productCache = cached;
            console.log("âœ… ä½¿ç”¨ localStorage å¿«å–å•†å“", cached.length, "ç­†");
            loadingStatus.style.display = "none";
            document.getElementById("searchBtn").disabled = false;
            return;
          }
        }
      } catch (e) {
        console.warn("å¿«å–è®€å–å¤±æ•—ï¼Œæ”¹èµ° Firestore", e);
      }

      // 2) è‹¥ç„¡å¿«å– â†’ Firestore æŠ“è³‡æ–™
      try {
        const snap = await getDocs(collection(db, "Products"));
        productCache = [];

        snap.forEach(docSnap => {
          const d = docSnap.data() || {};
          const model = (d.model || "").trim().toUpperCase();

          // ä¸»å‹è™Ÿä¾è¦å‰‡ç”¢ç”Ÿ
          const mainModel = getMainModel(model);

          // searchKeyï¼šè‹¥ Firestore æ²’çµ¦å°±è‡ªå·±çµ„
          const searchKey = normalizeKey(d.searchKey || `${model} ${d.name || ""}`);

          productCache.push({
            ...d,
            model,
            mainModel,
            searchKey
          });
        });

        // å¯«å…¥ localStorage
        localStorage.setItem(LS_KEY, JSON.stringify(productCache));

        console.log("âœ… Firestore å•†å“è¼‰å…¥å®Œæˆ", productCache.length, "ç­†");

      } catch (e) {
        console.error("âŒ Firestore é è¼‰å¤±æ•—ï¼š", e);
        alert("å•†å“è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– Firestore è¨­å®š");
      } finally {
        loadingStatus.style.display = "none";
        document.getElementById("searchBtn").disabled = false;
      }
    }


    /*  
    ============================================================
      èµ·è¨‚é‡é¸å–®ï¼ˆä¾æ¬Šé™ Levelï¼‰
    ============================================================
    */

    function setupQtySelectByLevel() {
      qtySelect.innerHTML = "";

      // ä¸ç”¨èµ·è¨‚é‡é¸é …
      const optNone = document.createElement("option");
      optNone.value = "";
      optNone.textContent = "ä¸ä½¿ç”¨èµ·è¨‚é‡";
      qtySelect.appendChild(optNone);

      const addOpt = (v, t) => {
        const o = document.createElement("option");
        o.value = v;
        o.textContent = t;
        qtySelect.appendChild(o);
      };

      if (userLevel >= 1) addOpt("50", "50 å€‹");
      if (userLevel >= 2) { addOpt("100", "100 å€‹"); addOpt("300", "300 å€‹"); }
      if (userLevel >= 3) { addOpt("500", "500 å€‹"); addOpt("1000", "1000 å€‹"); }
    }


    /*  
    ============================================================
      ä¸»å‹è™Ÿåˆä½µï¼ˆé¡è‰²åˆä½µï¼‰
      - åŒä¸»å‹è™Ÿåªç•™ä¸€ç­†ä»£è¡¨
      - é¡è‰²æ¬„ä½åšå½™ç¸½ï¼Œä½†ä»åªé¡¯ç¤ºä¸€ç­†
    ============================================================
    */

    function mergeByMainModel(list) {
      const map = {};

      list.forEach(item => {
        const main = item.mainModel || getMainModel(item.model);

        if (!map[main]) {
          map[main] = {
            ...item,
            mainModel: main,
            models: [item.model]
          };
        } else {
          // åŒä¸»å‹è™Ÿçš„å…¶å®ƒè‰² / å…¶å®ƒ SKU æ”¶é€² models
          map[main].models.push(item.model);

          // é€™é‚Šå¦‚æœä½ ä¹‹å¾Œè¦å½™ç¸½é¡è‰²æˆ–å…¶å®ƒæ¬„ä½ï¼Œå¯åŠ åœ¨é€™
        }
      });

      return Object.values(map);
    }


    /*  
    ============================================================
      æ’åº
    ============================================================
    */

    function applySorting(list) {
      const opt = sortSelect.value;

      if (opt === "minPriceAsc")  return list.sort((a, b) => a.minPrice - b.minPrice);
      if (opt === "minPriceDesc") return list.sort((a, b) => b.minPrice - a.minPrice);

      if (opt === "marketAsc")    return list.sort((a, b) => a.marketPrice - b.marketPrice);
      if (opt === "marketDesc")   return list.sort((a, b) => b.marketPrice - a.marketPrice);

      if (opt === "alphaAsc")     return list.sort((a, b) => a.mainModel.localeCompare(b.mainModel));
      if (opt === "alphaDesc")    return list.sort((a, b) => b.mainModel.localeCompare(a.mainModel));

      return list;
    }


    /*  
    ============================================================
      v4.5.1 æœå°‹è¦å‰‡ï¼ˆäº¤é›†ï¼‰
      å¯çµ„åˆæ¢ä»¶ï¼š
      1) åªé—œéµå­—
      2) èµ·è¨‚é‡ + é ç®—
      3) é—œéµå­— + èµ·è¨‚é‡ + é ç®—ï¼ˆäº¤é›†ï¼‰
    ============================================================
    */

    function searchProducts() {
      const key = normalizeKey(keywordInput.value);
      const qty = qtySelect.value;
      const minPraw = minPriceInput.value.trim();
      const maxPraw = maxPriceInput.value.trim();

      // è‹¥å®Œå…¨ç„¡æ¢ä»¶
      if (!key && !qty && !minPraw && !maxPraw) {
        alert("è«‹è‡³å°‘è¼¸å…¥é—œéµå­—ã€æˆ–é¸æ“‡èµ·è¨‚é‡ï¼é ç®—æœå°‹ã€‚");
        return;
      }

      // é ç®—è½‰æ•¸å­—ï¼ˆå¯ç©ºï¼‰
      const minP = minPraw ? Number(minPraw) : 0;
      const maxP = maxPraw ? Number(maxPraw) : Number.MAX_SAFE_INTEGER;

      // èµ·è¨‚é‡å°æ‡‰æˆæœ¬æ¬„ä½
      const costKey = qty ? `quote${qty}` : null;

      const result = productCache.filter(p => {
        // 1) é—œéµå­—æ¢ä»¶ï¼ˆè‹¥æœ‰ keyï¼‰
        if (key) {
          if (!(p.searchKey || "").includes(key)) return false;
        }

        // 2) èµ·è¨‚é‡ + é ç®—æ¢ä»¶ï¼ˆè‹¥æœ‰ qtyï¼‰
        if (qty) {
          const price = Number(p[costKey]) || 0;
          if (price < minP || price > maxP) return false;
        }

        return true;
      });

      currentResultList = applySorting(mergeByMainModel(result));
      renderResults(currentResultList);
    }


    /*  
    ============================================================
      æ¸²æŸ“æœå°‹çµæœ
    ============================================================
    */

    function renderResults(list) {
      resultBody.innerHTML = "";
      detailCard.style.display = "none";
      closeSheet();
      if (checkAllBox) checkAllBox.checked = false;

      if (!list.length) {
        resultTable.style.display = "none";
        exportBtn.disabled = true;
        return;
      }

      resultTable.style.display = "table";
      exportBtn.disabled = false;

      list.forEach(item => {
        const img = item.imageUrl || "https://placehold.co/120x120?text=No+Image";
        const tr = document.createElement("tr");

        // å„ level æˆæœ¬é¡¯ç¤º
        let priceHtml = "";
        if (userLevel >= 1) priceHtml += `<span class="price-tag tag50">50å€‹ï¼š${item.quote50}</span>`;
        if (userLevel >= 2) {
          priceHtml += `<span class="price-tag tag100">100å€‹ï¼š${item.quote100}</span>`;
          priceHtml += `<span class="price-tag tag300">300å€‹ï¼š${item.quote300}</span>`;
        }
        if (userLevel >= 3) {
          priceHtml += `<span class="price-tag tag500">500å€‹ï¼š${item.quote500}</span>`;
          priceHtml += `<span class="price-tag tag1000">1000å€‹ï¼š${item.quote1000}</span>`;
        }

        tr.innerHTML = `
          <td><input type="checkbox" class="row-check" data-model="${item.model}" /></td>
          <td><img src="${img}" class="product-img"></td>
          <td>${item.mainModel}</td>
          <td>
            <div style="font-weight:700;margin-bottom:4px;">${item.name || "-"}</div>
            <div class="price-tag-container" style="font-size:13px;margin-bottom:6px;">${priceHtml}</div>

            <div style="display:flex; gap:6px;">
              <button class="line-share-btn" data-model="${item.model}"
                style="margin-top:6px;padding:6px 10px;font-size:12px;background:#06C755;color:#fff;border:none;border-radius:6px;cursor:pointer;">
                LINE
              </button>

              <button class="btn-outline-add add-quote-btn" data-model="${item.model}">
                â• å ±åƒ¹å–®
              </button>
            </div>
          </td>
          <td style="text-align:right;">${item.minPrice || "-"}</td>
          <td style="text-align:right;">${item.marketPrice || "-"}</td>
        `;

        // æ¡Œæ©Ÿ hover / click é¡¯ç¤º detailCard
        if (window.innerWidth > 900) {
          tr.addEventListener("mouseenter", () => showDetailDesktop(item));
          tr.addEventListener("click", (e) => {
            if (e.target.tagName === "INPUT" || e.target.tagName === "BUTTON") return;
            showDetailDesktop(item);
          });
        } else {
          tr.addEventListener("click", (e) => {
            if (e.target.tagName === "INPUT" || e.target.tagName === "BUTTON") return;
            showDetailMobile(item);
          });
        }

        resultBody.appendChild(tr);
      });

      bindCheckAll();
    }


    /*  
    ============================================================
      è©³ç´°è³‡æ–™ï¼ˆæ¡Œæ©Ÿ / æ‰‹æ©Ÿï¼‰
    ============================================================
    */

    function buildPriceBlock(item) {
      let priceBlock = "";
      if (userLevel >= 1) priceBlock += `<div>50 å€‹ï¼š${item.quote50}</div>`;
      if (userLevel >= 2) priceBlock += `<div>100 å€‹ï¼š${item.quote100}</div><div>300 å€‹ï¼š${item.quote300}</div>`;
      if (userLevel >= 3) priceBlock += `<div>500 å€‹ï¼š${item.quote500}</div><div>1000 å€‹ï¼š${item.quote1000}</div>`;
      return priceBlock || "<div>æ­¤å¸³è™Ÿç„¡å¯è¦‹æ¡è³¼åƒ¹</div>";
    }

    function showDetailDesktop(item) {
      const img = item.imageUrl || "https://placehold.co/300x300?text=No+Image";
      const priceBlock = buildPriceBlock(item);

      detailCard.style.display = "block";
      detailCard.innerHTML = `
        <img src="${img}" style="width:100%;border-radius:10px;border:1px solid #eee;margin-bottom:10px;">
        <div style="font-weight:700;font-size:16px;margin-bottom:6px;">${item.name || "-"}</div>

        <div style="font-size:14px;line-height:1.6;margin-bottom:10px;">
          <strong>ä¸»å‹è™Ÿï¼š</strong>${item.mainModel}<br>
          <strong>è³£å ´ï¼š</strong>${item.marketPrice || "-"}<br>
          <strong>æœ«å”®ï¼š</strong>${item.minPrice || "-"}<br>
          <strong>ç®±å…¥æ•¸ï¼š</strong>${item.cartonQty || "-"}<br>
          <strong>ç¶²å€ï¼š</strong>${item.productUrl ? `<a href="${item.productUrl}" target="_blank">å‰å¾€å•†å“é </a>` : "-"}
        </div>

        <div style="font-weight:700;margin-bottom:6px;">æ¡è³¼åƒ¹æ ¼</div>
        <div style="line-height:1.6;">${priceBlock}</div>

        <div style="display:flex; gap:8px; margin-top:12px;">
          <button class="btn-primary line-share-btn" data-model="${item.model}" style="flex:1;">LINE åˆ†äº«</button>
          <button class="btn-outline-add add-quote-btn" data-model="${item.model}" style="flex:1;margin-top:0;">åŠ å…¥å ±åƒ¹å–®</button>
        </div>
      `;
    }

    function showDetailMobile(item) {
      const img = item.imageUrl || "https://placehold.co/300x300?text=No+Image";
      const priceBlock = buildPriceBlock(item);

      sheetContent.innerHTML = `
        <img src="${img}" style="width:100%;border-radius:10px;border:1px solid #eee;margin-bottom:10px;">
        <div style="font-weight:700;font-size:16px;margin-bottom:6px;">${item.name || "-"}</div>

        <div style="font-size:14px;line-height:1.6;margin-bottom:10px;">
          <strong>ä¸»å‹è™Ÿï¼š</strong>${item.mainModel}<br>
          <strong>è³£å ´ï¼š</strong>${item.marketPrice || "-"}<br>
          <strong>æœ«å”®ï¼š</strong>${item.minPrice || "-"}<br>
          <strong>ç®±å…¥æ•¸ï¼š</strong>${item.cartonQty || "-"}<br>
          <strong>ç¶²å€ï¼š</strong>${item.productUrl ? `<a href="${item.productUrl}" target="_blank">å‰å¾€å•†å“é </a>` : "-"}
        </div>

        <div style="font-weight:700;margin-bottom:6px;">æ¡è³¼åƒ¹æ ¼</div>
        <div style="line-height:1.6;">${priceBlock}</div>

        <div style="display:flex; gap:8px; margin-top:12px;">
          <button class="btn-primary line-share-btn" data-model="${item.model}" style="flex:1;">LINE åˆ†äº«</button>
          <button class="btn-outline-add add-quote-btn" data-model="${item.model}" style="flex:1;margin-top:0;">åŠ å…¥å ±åƒ¹å–®</button>
        </div>
      `;

      openSheet();
    }

    function openSheet() {
      sheetBackdrop.classList.remove("hidden");
      mobileSheet.classList.remove("hidden");
      requestAnimationFrame(() => mobileSheet.classList.add("open"));
    }

    function closeSheet() {
      mobileSheet.classList.remove("open");
      setTimeout(() => {
        mobileSheet.classList.add("hidden");
        if (quoteSheet.classList.contains("hidden")) sheetBackdrop.classList.add("hidden");
      }, 220);
    }


    /*  
    ============================================================
      å‹¾é¸å…¨é¸
    ============================================================
    */

    function bindCheckAll() {
      const rowChecks = document.querySelectorAll(".row-check");

      checkAllBox.onchange = () => rowChecks.forEach(c => c.checked = checkAllBox.checked);

      rowChecks.forEach(chk => {
        chk.onchange = () => {
          const all = document.querySelectorAll(".row-check");
          const checked = document.querySelectorAll(".row-check:checked");
          checkAllBox.checked = (all.length === checked.length);
        };
      });
    }


    /*  
    ============================================================
      å ±åƒ¹å–®ï¼ˆåŠ å…¥ / åˆªé™¤ / ç¸½é¡ / æ¯›åˆ©ï¼‰
    ============================================================
    */

    function renderQuoteList() {
      quoteListBody.innerHTML = "";
      let total = 0;
      let totalMarket = 0;

      if (!quoteList.length) {
        quoteListBody.innerHTML = `<div style="text-align:center;padding:40px;color:#999;">å ±åƒ¹å–®æ˜¯ç©ºçš„</div>`;
        quoteTotalEl.textContent = "$0";
        quoteProfitEl.textContent = "0%";
        return;
      }

      quoteList.forEach((q, idx) => {
        const sub = q.price * q.count;
        total += sub;

        // ç”¨è³£å ´åƒ¹ç´¯è¨ˆç®—æ¯›åˆ©ï¼ˆè‹¥æœ‰ marketPriceï¼‰
        totalMarket += (q.marketPrice || 0) * q.count;

        const div = document.createElement("div");
        div.className = "quote-item";
        div.innerHTML = `
          <div style="flex:1;">
            <div style="font-weight:700;">${q.name}</div>
            <div class="quote-info" style="color:#666;">
              ${q.model} | ${q.qtyLabel}
            </div>
          </div>

          <div style="text-align:right;margin-right:8px;">
            <div class="quote-price">$${q.price}</div>
            <div style="font-size:12px;color:#888;">x ${q.count}</div>
          </div>

          <div class="quote-del" data-idx="${idx}">ğŸ—‘ï¸</div>
        `;
        quoteListBody.appendChild(div);
      });

      quoteTotalEl.textContent = "$" + total.toLocaleString();

      // æ¯›åˆ©è¨ˆç®—ï¼š (è³£å ´ç¸½é¡ - æˆæœ¬ç¸½é¡) / è³£å ´ç¸½é¡
      let profitPct = 0;
      if (totalMarket > 0) {
        profitPct = Math.round(((totalMarket - total) / totalMarket) * 100);
      }
      quoteProfitEl.textContent = profitPct + "%";

      // ç¶åˆªé™¤
      document.querySelectorAll(".quote-del").forEach(btn => {
        btn.onclick = (e) => {
          const i = Number(e.target.getAttribute("data-idx"));
          quoteList.splice(i, 1);
          renderQuoteList();
        };
      });
    }


    /*  
    ============================================================
      Excel åŒ¯å‡ºï¼ˆä¸»å‹è™Ÿä»£è¡¨ä¸€ç­†ï¼‹èµ·è¨‚é‡è¦å‰‡ï¼‰
      - è‹¥æœ‰é¸èµ·è¨‚é‡ï¼šåªåŒ¯å‡ºè©²èµ·è¨‚é‡çš„å–®åƒ¹ + æœ«å”® + è³£å ´
      - è‹¥æ˜¯ç´”é—œéµå­—æœå°‹ï¼ˆæœªé¸èµ·è¨‚é‡ï¼‰ï¼šä¸åŒ¯å‡ºæ¡è³¼åƒ¹ï¼ˆåªåŒ¯æœ«å”®ï¼è³£å ´ï¼‰
      - åœ–ç‰‡æ¬„ä½ => åŒ¯å‡º imageUrlï¼ˆExcel ç«¯å¯è¦‹é€£çµï¼‰
    ============================================================
    */

    function exportSelectedExcel() {
      const checked = document.querySelectorAll(".row-check:checked");
      if (!checked.length) { alert("è«‹å…ˆå‹¾é¸è¦åŒ¯å‡ºçš„å•†å“"); return; }

      const selectedModels = Array.from(checked).map(c => c.getAttribute("data-model"));

      // åŸºç¤æ¬„ä½
      const baseHeader = [
        "å•†å“å‹è™Ÿ", "ä¸»å‹è™Ÿ", "å•†å“åç¨±",
        "ç®±å…¥æ•¸", "Barcode", "BSMI", "NCC",
        "å•†å“é€£çµ", "åœ–ç‰‡é€£çµ"
      ];

      // åƒ¹æ ¼æ¬„ä½ä¾è¦å‰‡æ±ºå®š
      let priceHeader = [];
      const qty = qtySelect.value;

      if (qty) {
        priceHeader = [`${qty}å€‹æ¡è³¼åƒ¹`, "æœ«å”®", "è³£å ´"];
      } else {
        // ç´”é—œéµå­—æœå°‹ï¼šä¸è¼¸å‡ºæ¡è³¼åƒ¹
        priceHeader = ["æœ«å”®", "è³£å ´"];
      }

      const rows = [[...baseHeader, ...priceHeader]];

      selectedModels.forEach(m => {
        const item = currentResultList.find(p => p.model === m);
        if (!item) return;

        const baseRow = [
          item.model,
          item.mainModel,
          item.name,
          item.cartonQty || "",
          item.barcode || "",
          item.bsmi || "",
          item.ncc || "",
          item.productUrl || "",
          item.imageUrl || ""
        ];

        let priceRow = [];
        if (qty) {
          const ck = `quote${qty}`;
          const costVal = item[ck] || item.quote50 || 0;
          priceRow = [costVal, item.minPrice || 0, item.marketPrice || 0];
        } else {
          priceRow = [item.minPrice || 0, item.marketPrice || 0];
        }

        rows.push([...baseRow, ...priceRow]);
      });

      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(rows);
      XLSX.utils.book_append_sheet(wb, ws, "å ±åƒ¹");
      XLSX.writeFile(wb, `KINYO_å•†å“å ±åƒ¹_${qty ? qty + 'å€‹' : 'é—œéµå­—'}_v451.xlsx`);
    }


    /*  
    ============================================================
      äº‹ä»¶ç¶å®š
    ============================================================
    */

    // æŸ¥è©¢
    document.getElementById("searchBtn").onclick = searchProducts;

    // Enter æœå°‹ï¼ˆä½ èªªè¦æ¢å¾©ï¼‰
    [keywordInput, qtySelect, minPriceInput, maxPriceInput].forEach(el => {
      el.addEventListener("keydown", e => {
        if (e.key === "Enter") searchProducts();
      });
    });

    // åŒ¯å‡º Excel
    exportBtn.onclick = exportSelectedExcel;

    // æ¸…é™¤æœå°‹
    clearBtn.onclick = () => {
      keywordInput.value = "";
      qtySelect.value = "";
      minPriceInput.value = "";
      maxPriceInput.value = "";
      resultBody.innerHTML = "";
      resultTable.style.display = "none";
      exportBtn.disabled = true;
      detailCard.style.display = "none";
    };

    // æ’åº
    sortSelect.onchange = () => {
      if (currentResultList.length > 0) {
        currentResultList = applySorting([...currentResultList]);
        renderResults(currentResultList);
      }
    };

    // åŠ å…¥å ±åƒ¹å–®ï¼‹LINE åˆ†äº«ï¼ˆäº‹ä»¶ä»£ç†ï¼‰
    document.addEventListener("click", (e) => {

      // åŠ å…¥å ±åƒ¹å–®
      if (e.target.classList.contains("add-quote-btn")) {
        const model = e.target.getAttribute("data-model");
        const item = currentResultList.find(p => p.model === model);
        if (!item) return;

        const qty = qtySelect.value || "50";
        const ck = `quote${qty}`;
        const cost = item[ck] || item.quote50 || 0;

        quoteList.push({
          model: item.model,
          name: item.name,
          price: cost,
          qtyLabel: `${qty}å€‹`,
          count: 1,
          marketPrice: item.marketPrice || 0
        });

        alert(`å·²åŠ å…¥å ±åƒ¹å–®ï¼ˆ${qty}å€‹ï¼š$${cost}ï¼‰`);
        renderQuoteList();
      }

      // LINE åˆ†äº«ï¼ˆè¤‡è£½ï¼‰
      if (e.target.classList.contains("line-share-btn")) {
        const model = e.target.getAttribute("data-model");
        const item = currentResultList.find(p => p.model === model);
        if (!item) return;

        let costText = "";
        if (userLevel >= 1) costText += `50å€‹ï¼š${item.quote50}\n`;
        if (userLevel >= 2) costText += `100å€‹ï¼š${item.quote100}\n300å€‹ï¼š${item.quote300}\n`;
        if (userLevel >= 3) costText += `500å€‹ï¼š${item.quote500}\n1000å€‹ï¼š${item.quote1000}\n`;

        const text = `ğŸ”¥ã€${item.model}ã€‘${item.name}
è³£å ´å”®åƒ¹ï¼š${item.marketPrice}
æœ«å”®åƒ¹æ ¼ï¼š${item.minPrice}
--------------------
æ¡è³¼åƒ¹æ ¼ï¼š
${costText}
å•†å“é€£çµï¼š${item.productUrl || "ç„¡"}`;

        navigator.clipboard.writeText(text)
          .then(() => alert("å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿"))
          .catch(() => alert("è¤‡è£½å¤±æ•—"));
      }
    });

    // é–‹å•Ÿå ±åƒ¹å–®
    openQuoteBtn.onclick = () => {
      sheetBackdrop.classList.remove("hidden");
      quoteSheet.classList.remove("hidden");
      requestAnimationFrame(() => quoteSheet.classList.add("open"));
      renderQuoteList();
    };

    // é—œé–‰å ±åƒ¹å–®
    quoteCloseBtn.onclick = () => {
      quoteSheet.classList.remove("open");
      setTimeout(() => quoteSheet.classList.add("hidden"), 220);
      if (mobileSheet.classList.contains("hidden")) sheetBackdrop.classList.add("hidden");
    };

    // backdrop é»æ“Šé—œé–‰
    sheetBackdrop.onclick = () => {
      closeSheet();
      quoteSheet.classList.remove("open");
      setTimeout(() => quoteSheet.classList.add("hidden"), 220);
      sheetBackdrop.classList.add("hidden");
    };

    sheetCloseBtn.onclick = closeSheet;

    // æ¸…ç©ºå ±åƒ¹å–®
    clearQuoteBtn.onclick = () => {
      if (confirm("ç¢ºå®šè¦æ¸…ç©ºå ±åƒ¹å–®å—ï¼Ÿ")) {
        quoteList = [];
        renderQuoteList();
      }
    };

    // è¤‡è£½æ•´å¼µå ±åƒ¹å–®ï¼ˆLINEï¼‰
    copyQuoteBtn.onclick = () => {
      if (!quoteList.length) return;

      let text = "ğŸ“‹ KINYO å•†å“å ±åƒ¹å–®\n----------------------\n";
      let total = 0;

      quoteList.forEach((q, i) => {
        const sub = q.price * q.count;
        total += sub;
        text += `${i + 1}. ã€${q.model}ã€‘${q.name}\n   è¦æ ¼ï¼š${q.qtyLabel} | å–®åƒ¹ï¼š$${q.price}\n`;
      });

      text += "----------------------\n";
      text += `ğŸ’° ç¸½è¨ˆé‡‘é¡ï¼š$${total.toLocaleString()}`;

      navigator.clipboard.writeText(text)
        .then(() => alert("å ±åƒ¹å–®å·²è¤‡è£½"))
        .catch(() => alert("è¤‡è£½å¤±æ•—"));
    };


    /*  
    ============================================================
      Firebase Authï¼ˆç™»å…¥/æ¬Šé™ï¼‰
    ============================================================
    */

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      currentUserEmail = user.email || "";

      // è®€ Users level
      try {
        const userDoc = await getDoc(doc(db, "Users", currentUserEmail.toLowerCase()));
        if (userDoc.exists()) userLevel = userDoc.data().level || 1;
      } catch (e) {
        userLevel = 1;
      }

      // é¡¯ç¤ºå¸³è™Ÿ
      userInfoSpan.textContent = `ç™»å…¥å¸³è™Ÿï¼š${currentUserEmail.replace(/@.*/, "")}`;
      logoutBtn.style.display = "inline-block";

      // åˆå§‹åŒ– UI
      setupQtySelectByLevel();

      // é è¼‰
      preloadProducts();
    });

    logoutBtn.onclick = () => signOut(auth);

  </script>

</body>
</html>